---
  - name: upgrading bios idrac network and Sas firmware version for dell fc630 and r630 model
    hosts: all
    gather_facts: true

    tasks:
      - name: check  server models
        shell: dmidecode -s system-product-name
        register: servermodel

      - debug:
          msg: Server model is "{{ servermodel.stdout }}"

      - name: Untar the files
        unarchive:
          ## change source  ( put location of the tar file on bastion host)
          src: /Users/sabarishreddy/bios/r630_fwbin_2019.tar.gz
          dest: /tmp
        when: servermodel.stdout == "PowerEdge R630"

      - name: Ensure target directory exists
        file:
          dest: "/tmp/r630_fwbin_2019"
          state: directory
        when: servermodel.stdout == "PowerEdge R630"

      - name: updating the R630
        command: ./tmp/r630_fwbin_2019/BIOS_2JFRF_LN_2.8.0.BIN -q
        when: servermodel.stdout == "PowerEdge R630"

      - name: updating the R630
        command: ./tmp/r630_fwbin_2019/Firmware_HYPYY_LN_3.35_A00-00.BIN -q
        when: servermodel.stdout == "PowerEdge R630"

      - name: updating the R630
        command: ./tmp/r630_fwbin_2019/iDRAC-with-Lifecycle-Controller_Firmware_CX8N2_LN_2.60.60.60_A00.BIN -q
        when: servermodel.stdout == "PowerEdge R630"

      - name: updating the R630
        command: ./tmp/r630_fwbin_2019/Network_Firmware_3XJH0_LN_18.5.18_A00.BIN -q
        when: servermodel.stdout == "PowerEdge R630"

      - name: updating the R630
        command: ./tmp/r630_fwbin_2019/SAS-RAID_Firmware_F675Y_LN_25.5.5.0005_A13.BIN -q
        when: servermodel.stdout == "PowerEdge R630"

      - name: Untar the files
        unarchive:
          ## change source ( put location of the tar file on bastion host)
          src: /Users/sabarishreddy/bios/fc630_fwbin_2019.tar.gz
          dest: /tmp
        when: servermodel.stdout == "PowerEdge FC630"

      - name: Ensure target directory exists
        file:
          dest: "/tmp/fc630_fwbin_2019"
          state: directory
        when: servermodel.stdout == "PowerEdge FC630"

      - name: updating the FC630
        shell: ./tmp/fc630_fwbin_2019/BIOS_GV0FD_LN_2.8.0.BIN -q
        when: servermodel.stdout == "PowerEdge FC630"

      - name: updating the FC630
        shell: ./tmp/fc630_fwbin_2019/Firmware_M2YKM_LN_3.31_A00-00_01.BIN -q
        when: servermodel.stdout == "PowerEdge FC630"

      - name: updating the FC630
        shell: ./tmp/fc630_fwbin_2019/iDRAC-with-Lifecycle-Controller_Firmware_CX8N2_LN_2.60.60.60_A00.BIN -q
        when: servermodel.stdout == "PowerEdge FC630"

      - name: updating the FC630
        shell: ./tmp/fc630_fwbin_2019/Network_Firmware_3XJH0_LN_18.5.18_A00.BIN -q
        when: servermodel.stdout == "PowerEdge FC630"

      - name: updating the FC630
        shell: ./tmp/fc630_fwbin_2019/SAS-RAID_Firmware_F675Y_LN_25.5.5.0005_A13.BIN -q
        when: servermodel.stdout == "PowerEdge FC630"
